<script src="https://unpkg.com/html5-qrcode"></script>
    <div id="reader"></div>

    <!-- Контейнер для сообщений -->
    <div id="message-box" class="info">Готов к сканированию...</div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const html5QrCode = new Html5Qrcode("reader");
            const messageBox = document.getElementById("message-box");

            function showMessage(text, type = "info") {
                messageBox.textContent = text;
                messageBox.className = type;
            }

            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                qrCodeMessage => {
                    html5QrCode.stop().then(() => {
                        if (window.Telegram && Telegram.WebApp) {
                            Telegram.WebApp.sendData(qrCodeMessage);
                            showMessage("✅ Данные успешно отправлены в Telegram", "success");
                            setTimeout(() => {
                                Telegram.WebApp.close();
                            }, 1000);
                        } else {
                            showMessage("⚠️ Не в Telegram. Просто покажем QR: " + qrCodeMessage, "info");
                        }
                    }).catch(err => {
                        showMessage("❌ Ошибка остановки сканера: " + err, "error");
                    });
                }
            ).catch(err => {
                showMessage("❌ Не удалось запустить сканер: " + err, "error");
            });
        });
    </script>
